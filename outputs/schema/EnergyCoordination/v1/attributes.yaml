openapi: 3.1.1
info:
  title: Energy Coordination — Coordination Attributes (v1)
  version: 1.0.0
  x-profile-id: profiles/energy-coordination/energy_coordination/v1/coordination
  description: >
    Attribute schemas for energy coordination extensions.
    These attributes extend EnergyResource, EnergyTradeOffer, EnergyTradeContract, and EnergyTradeDelivery
    to enable bid curve expression, objective-driven coordination, locational pricing, market clearing,
    and multi-party settlement. Used across Item.itemAttributes, Offer.offerAttributes, Order.orderAttributes,
    and Fulfillment.attributes.

components:
  schemas:
    ########################################################################
    # COORDINATION EXTENSIONS — Shared Across Attribute Slots
    ########################################################################

    BidCurvePoint:
      type: object
      description: A single price/power pair in a bid curve.
      additionalProperties: false
      required: [price, powerKW]
      properties:
        price:
          type: number
          minimum: 0
          description: Price per kilowatt-hour at this power level.
          example: 0.06
          x-jsonld: { "@id": "schema:price" }
        powerKW:
          type: number
          description: Power level in kilowatts. Negative values indicate consumption (charging, load), positive values indicate generation (discharge, export), zero indicates no participation.
          example: 2.0
          x-jsonld: { "@id": "beckn:powerKW" }

    BidCurveConstraints:
      type: object
      description: Operational constraints for bid curve execution.
      additionalProperties: false
      properties:
        minPowerKW:
          type: number
          description: Minimum power level in kilowatts.
          example: 0
          x-jsonld: { "@id": "beckn:minPowerKW" }
        maxPowerKW:
          type: number
          description: Maximum power level in kilowatts.
          example: 5
          x-jsonld: { "@id": "beckn:maxPowerKW" }
        rampRateKWPerMin:
          type: number
          minimum: 0
          description: Maximum rate of power change in kilowatts per minute.
          example: 0.5
          x-jsonld: { "@id": "beckn:rampRateKWPerMin" }

    EnergyObjectives:
      type: object
      description: Structured objectives for energy resources expressing goals, constraints, and preferences.
      additionalProperties: false
      properties:
        targetChargeKWh:
          type: number
          minimum: 0
          description: Target energy to charge (for batteries, EVs).
          example: 20
          x-jsonld: { "@id": "beckn:targetChargeKWh" }
        targetGenerationKWh:
          type: number
          minimum: 0
          description: Target energy to generate (for solar, wind).
          example: 30
          x-jsonld: { "@id": "beckn:targetGenerationKWh" }
        targetReductionKW:
          type: number
          maximum: 0
          description: Target demand reduction (for demand flexibility).
          example: -50
          x-jsonld: { "@id": "beckn:targetReductionKW" }
        deadline:
          type: string
          format: date-time
          description: Deadline for achieving the objective (ISO 8601).
          example: "2024-12-15T18:00:00Z"
          x-jsonld: { "@id": "schema:endTime" }
        maxPricePerKWh:
          type: number
          minimum: 0
          description: Maximum acceptable price per kilowatt-hour.
          example: 0.12
          x-jsonld: { "@id": "beckn:maxPricePerKWh" }
        minPricePerKWh:
          type: number
          minimum: 0
          description: Optional. Minimum acceptable price per kilowatt-hour (for generators). Can also be expressed via bidCurve first point.
          example: 0.05
          x-jsonld: { "@id": "beckn:minPricePerKWh" }
        preferredSource:
          type: string
          enum: [SOLAR, BATTERY, GRID, HYBRID, RENEWABLE]
          description: Optional. Preferred energy source type. Can be expressed via discovery filters.
          example: "SOLAR"
          x-jsonld: { "@id": "beckn:preferredSource" }

    # Note: LocationalPriceAdder and GridConstraints have been moved to GridNode schema
    # See ../GridNode/v1/attributes.yaml

    Settlement:
      type: object
      description: Settlement information including revenue flows and billing report. Enables unambiguous multi-party billing.
      additionalProperties: false
      x-jsonld:
        "@context": ./context.jsonld
        "@type": Settlement
      properties:
        # Note: settlementCycles are tracked in EnergyTradeContract.settlementCycles
        revenueFlows:
          type: array
          description: Array of revenue flow entries for multi-party settlement.
          items:
            $ref: '#/components/schemas/RevenueFlow'
          x-jsonld: { "@id": "beckn:revenueFlows" }
        settlementReport:
          $ref: '#/components/schemas/SettlementReport'
          description: Structured billing document for settlement.

    RevenueFlow:
      type: object
      description: A single revenue flow entry for a party.
      additionalProperties: false
      properties:
        party:
          $ref: '#/components/schemas/Party'
          description: Party receiving revenue.
        amount:
          type: number
          minimum: 0
          description: Revenue amount for this party.
          example: 60.0
          x-jsonld: { "@id": "schema:amount" }
        currency:
          type: string
          description: Currency code (ISO 4217).
          example: "INR"
          x-jsonld: { "@id": "schema:currency" }
        description:
          type: string
          description: Description of the revenue flow.
          example: "Energy sale (10 kWh × ₹6/kWh)"
          x-jsonld: { "@id": "schema:description" }

    Party:
      type: object
      description: Structure for party identification.
      additionalProperties: false
      properties:
        era:
          type: string
          description: Energy Resource Address of the party.
          example: "prosumer-solar-001"
          x-jsonld: { "@id": "beckn:era" }
        role:
          type: string
          enum: [SELLER, BUYER, GRID_OPERATOR, AGGREGATOR, GOVERNMENT, MARKET_CLEARING_AGENT]
          description: Role of the party in the transaction.
          example: "SELLER"
          x-jsonld: { "@id": "beckn:role" }

    SettlementReport:
      type: object
      description: Structured billing document for settlement.
      additionalProperties: false
      properties:
        reportId:
          type: string
          description: Unique identifier for the settlement report.
          example: "settle-report-2024-10-04-001"
          x-jsonld: { "@id": "beckn:reportId" }
        totalAmount:
          type: number
          minimum: 0
          description: Total settlement amount.
          example: 100.0
          x-jsonld: { "@id": "beckn:totalAmount" }
        currency:
          type: string
          description: Currency code (ISO 4217).
          example: "INR"
          x-jsonld: { "@id": "schema:currency" }
        generatedAt:
          type: string
          format: date-time
          description: Timestamp when the settlement report was generated (ISO 8601).
          example: "2024-10-04T18:30:00Z"
          x-jsonld: { "@id": "schema:dateCreated" }
        # Note: breakdown can be calculated from revenueFlows

    OffsetCommand:
      type: object
      description: Grid operator command to apply offset for flat bid curve plateaus.
      additionalProperties: false
      properties:
        offsetKW:
          type: number
          description: Power offset in kilowatts to apply. Negative values reduce setpoint, positive values increase setpoint. Presence of this property indicates the command is enabled.
          example: -2.0
          x-jsonld: { "@id": "beckn:offsetKW" }

    ########################################################################
    # AGGREGATE ACTION SCHEMAS
    ########################################################################

    AggregationRequest:
      type: object
      description: Request for bid curve aggregation and market clearing.
      additionalProperties: false
      x-jsonld:
        "@context": ./context.jsonld
        "@type": AggregationRequest
      properties:
        participants:
          type: array
          description: Array of participants with bid curves.
          items:
            $ref: '#/components/schemas/Participant'
          x-jsonld: { "@id": "beckn:participants" }
        aggregationType:
          type: string
          enum: [MARKET_CLEARING, CAPACITY_AGGREGATION]
          description: Type of aggregation.
          example: "MARKET_CLEARING"
          x-jsonld: { "@id": "beckn:aggregationType" }
        timeWindow:
          type: object
          description: Time window for aggregation.
          additionalProperties: false
          properties:
            start:
              type: string
              format: date-time
              description: Aggregation start time (ISO 8601).
              example: "2024-12-15T14:00:00Z"
              x-jsonld: { "@id": "schema:startTime" }
            end:
              type: string
              format: date-time
              description: Aggregation end time (ISO 8601).
              example: "2024-12-15T16:00:00Z"
              x-jsonld: { "@id": "schema:endTime" }
          x-jsonld: { "@id": "beckn:timeWindow" }

    Participant:
      type: object
      description: A participant in the aggregation with bid curve and optional locational pricing.
      additionalProperties: false
      properties:
        era:
          type: string
          description: Energy Resource Address of the participant.
          example: "solar-panel-001"
          x-jsonld: { "@id": "beckn:era" }
        bidCurve:
          type: array
          description: Bid curve for this participant.
          items:
            $ref: '#/components/schemas/BidCurvePoint'
          x-jsonld: { "@id": "beckn:bidCurve" }
        constraints:
          $ref: '#/components/schemas/BidCurveConstraints'
          description: Operational constraints for this participant.
        # Note: locationalPriceAdder is available in GridNode schema

    AggregationResult:
      type: object
      description: Result of bid curve aggregation and market clearing.
      additionalProperties: false
      x-jsonld:
        "@context": ./context.jsonld
        "@type": AggregationResult
      properties:
        clearingPrice:
          type: number
          minimum: 0
          description: Market clearing price per kilowatt-hour.
          example: 0.075
          x-jsonld: { "@id": "beckn:clearingPrice" }
        clearingQuantityKW:
          type: number
          description: Clearing quantity in kilowatts.
          example: 50.0
          x-jsonld: { "@id": "beckn:clearingQuantityKW" }
        setpoints:
          type: array
          description: Array of setpoints for each participant.
          items:
            $ref: '#/components/schemas/Setpoint'
          x-jsonld: { "@id": "beckn:setpoints" }
        locationalPrice:
          type: number
          minimum: 0
          description: Final price including locational adder.
          example: 0.175
          x-jsonld: { "@id": "beckn:locationalPrice" }
        aggregatedSupplyCurve:
          type: array
          description: Aggregated supply curve (for reference).
          items:
            $ref: '#/components/schemas/BidCurvePoint'
          x-jsonld: { "@id": "beckn:aggregatedSupplyCurve" }
        aggregatedDemandCurve:
          type: array
          description: Aggregated demand curve (for reference).
          items:
            $ref: '#/components/schemas/BidCurvePoint'
          x-jsonld: { "@id": "beckn:aggregatedDemandCurve" }
        timestamp:
          type: string
          format: date-time
          description: Timestamp of the aggregation result (ISO 8601).
          example: "2024-12-15T14:00:00Z"
          x-jsonld: { "@id": "schema:dateCreated" }

    Setpoint:
      type: object
      description: Power setpoint for a resource.
      additionalProperties: false
      properties:
        era:
          type: string
          description: Energy Resource Address of the resource.
          example: "solar-panel-001"
          x-jsonld: { "@id": "beckn:era" }
        setpointKW:
          type: number
          description: Power setpoint in kilowatts. Negative for consumption, positive for generation.
          example: 3.5
          x-jsonld: { "@id": "beckn:setpointKW" }

