openapi: 3.1.1
info:
  title: Energy Trade — Trade Contract Attributes (v0.2) with Coordination Extensions
  version: 0.2.0
  x-profile-id: profiles/energy-trade/energy_trade/v0.2/trade-contract
  description: >
    Attribute schemas for energy trade contracts (Order.orderAttributes).
    These attributes are attached to Order.orderAttributes to track commercial agreements
    for energy transactions, including contract status, meter identifiers, settlement cycles,
    billing cycles, energy delivery details, and coordination extensions (objectives, 
    setpoints, clearing prices, settlement, offset commands).

components:
  schemas:
    ########################################################################
    # ORDER.ORDERATTRIBUTES — EnergyTradeContract (P2P Energy Trading + Coordination)
    ########################################################################
    EnergyTradeContract:
      type: object
      additionalProperties: false
      x-jsonld:
        "@context": ./context.jsonld
        "@type": EnergyTradeContract
      properties:

        # Core Energy Trade Contract Properties
        contractStatus:
          type: string
          enum: [PENDING, ACTIVE, COMPLETED, TERMINATED]
          description: Contract lifecycle status. Decouples trade from fulfillment - generator, transmitter, and consumer operate independently.
          example: "ACTIVE"
          x-jsonld: { "@id": contractStatus }

        sourceMeterId:
          type: string
          description: Source meter identifier using IEEE 2030.5 mRID (meter Resource ID). Identifies the energy generator.
          example: "100200300"
          x-jsonld: { "@id": "ieee:mRID" }

        targetMeterId:
          type: string
          description: Target/consumer meter identifier using IEEE 2030.5 mRID (meter Resource ID). Identifies the energy consumer.
          example: "98765456"
          x-jsonld: { "@id": "ieee:mRID" }

        inverterId:
          type: string
          description: Inverter identifier serving as consistent interface between source and grid. Remains constant even if source changes.
          example: "inv-12345"
          x-jsonld: { "@id": inverterId }

        contractedQuantity:
          type: number
          minimum: 0
          description: Contracted energy quantity in kilowatt-hours (kWh).
          example: 10.0
          x-jsonld: { "@id": contractedQuantity }

        tradeStartTime:
          type: string
          format: date-time
          description: Contract start time (ISO 8601).
          example: "2024-10-04T10:00:00Z"
          x-jsonld: { "@id": "schema:startTime" }

        tradeEndTime:
          type: string
          format: date-time
          description: Contract end time (ISO 8601). Null for ongoing contracts.
          example: "2024-10-04T18:00:00Z"
          x-jsonld: { "@id": "schema:endTime" }

        sourceType:
          type: string
          enum: [SOLAR, BATTERY, GRID, HYBRID, RENEWABLE]
          description: Energy source type at contract time. May differ from current source type.
          example: "SOLAR"
          x-jsonld: { "@id": sourceType }

        certification:
          type: object
          description: Energy certification details at contract time.
          x-jsonld: { "@id": certification }
          additionalProperties: false
          properties:
            status:
              type: string
              description: Certification status (e.g., "Carbon Offset Certified", "Green Energy Certified").
              example: "Carbon Offset Certified"
              x-jsonld: { "@id": "schema:name" }
            certificates:
              type: array
              description: Array of certificate references (URLs or identifiers).
              items:
                type: string
                format: uri
              example: ["https://example.com/certs/solar-panel-cert.pdf"]
              x-jsonld: { "@id": certificates }

        settlementCycles:
          type: array
          description: Array of settlement cycles for recurring contracts. Supports single order with multiple billing or fulfillment cycles.
          items:
            type: object
            additionalProperties: false
            properties:
              cycleId:
                type: string
                description: Unique settlement cycle identifier.
                example: "settle-2024-10-04-001"
                x-jsonld: { "@id": cycleId }
              startTime:
                type: string
                format: date-time
                description: Settlement cycle start time (ISO 8601).
                example: "2024-10-04T00:00:00Z"
                x-jsonld: { "@id": "schema:startTime" }
              endTime:
                type: string
                format: date-time
                description: Settlement cycle end time (ISO 8601).
                example: "2024-10-04T23:59:59Z"
                x-jsonld: { "@id": "schema:endTime" }
              status:
                type: string
                enum: [PENDING, SETTLED, FAILED]
                description: Settlement cycle status.
                example: "SETTLED"
                x-jsonld: { "@id": status }
              amount:
                type: number
                minimum: 0
                description: Settlement amount for this cycle.
                example: 50.0
                x-jsonld: { "@id": "schema:amount" }
              currency:
                type: string
                description: Currency code (ISO 4217).
                example: "USD"
                x-jsonld: { "@id": "schema:currency" }
          x-jsonld: { "@id": settlementCycles }

        billingCycles:
          type: array
          description: Array of billing periods for the contract. Supports ongoing connections billed periodically.
          items:
            type: object
            additionalProperties: false
            properties:
              cycleId:
                type: string
                description: Unique billing cycle identifier.
                example: "bill-2024-10-001"
                x-jsonld: { "@id": cycleId }
              startTime:
                type: string
                format: date-time
                description: Billing cycle start time (ISO 8601).
                example: "2024-10-01T00:00:00Z"
                x-jsonld: { "@id": "schema:startTime" }
              endTime:
                type: string
                format: date-time
                description: Billing cycle end time (ISO 8601).
                example: "2024-10-31T23:59:59Z"
                x-jsonld: { "@id": "schema:endTime" }
              status:
                type: string
                enum: [PENDING, PAID, OVERDUE]
                description: Billing cycle payment status.
                example: "PAID"
                x-jsonld: { "@id": status }
              totalAmount:
                type: number
                minimum: 0
                description: Total billing amount for this cycle.
                example: 150.0
                x-jsonld: { "@id": "schema:amount" }
              currency:
                type: string
                description: Currency code (ISO 4217).
                example: "USD"
                x-jsonld: { "@id": "schema:currency" }
              lineItems:
                type: array
                description: Billing line items including energy cost and wheeling charges.
                items:
                  type: object
                  additionalProperties: false
                  properties:
                    title:
                      type: string
                      description: Line item title.
                      example: "Energy Cost"
                      x-jsonld: { "@id": "schema:name" }
                    amount:
                      type: number
                      minimum: 0
                      description: Line item amount.
                      example: 100.0
                      x-jsonld: { "@id": "schema:amount" }
                    currency:
                      type: string
                      description: Currency code (ISO 4217).
                      example: "USD"
                      x-jsonld: { "@id": "schema:currency" }
                x-jsonld: { "@id": lineItems }
          x-jsonld: { "@id": billingCycles }

        wheelingCharges:
          type: object
          description: Utility wheeling charges breakdown (e.g., PG&E fixed charges).
          x-jsonld: { "@id": wheelingCharges }
          additionalProperties: false
          properties:
            utilityName:
              type: string
              description: Name of the utility providing wheeling services.
              example: "PG&E Grid Services"
              x-jsonld: { "@id": "schema:name" }
            amount:
              type: number
              minimum: 0
              description: Total wheeling charge amount.
              example: 2.5
              x-jsonld: { "@id": "schema:amount" }
            currency:
              type: string
              description: Currency code (ISO 4217).
              example: "USD"
              x-jsonld: { "@id": "schema:currency" }
            description:
              type: string
              description: Description of wheeling charges.
              example: "Fixed wheeling charges for grid transmission"
              x-jsonld: { "@id": "schema:description" }

        lastUpdated:
          type: string
          format: date-time
          description: Last contract update timestamp (UTC).
          example: "2024-10-04T15:30:00Z"
          x-jsonld: { "@id": "schema:dateModified" }

        # Coordination Extensions
        bidCurve:
          type: array
          description: Bid curve submitted during init phase. Used for market clearing.
          items:
            $ref: '#/components/schemas/BidCurvePoint'
          x-jsonld: { "@id": "energyCoordination:bidCurve" }

        objectives:
          $ref: '#/components/schemas/EnergyObjectives'
          description: Resource objectives expressing goals, constraints, and preferences for energy transactions.

        approvedMaxTradeKW:
          type: number
          minimum: 0
          description: Utility-approved maximum trade volume in kilowatts (relative to sanctioned load). Set during init phase via cascaded init.
          example: 30
          x-jsonld: { "@id": "energyCoordination:approvedMaxTradeKW" }

        clearingPrice:
          type: number
          minimum: 0
          description: Market-cleared price per kilowatt-hour. Locked at confirmation time (synchronous market clearing).
          example: 0.075
          x-jsonld: { "@id": "energyCoordination:clearingPrice" }

        setpointKW:
          type: number
          description: Confirmed power setpoint in kilowatts from market clearing. Negative for consumption, positive for generation.
          example: -8.0
          x-jsonld: { "@id": "energyCoordination:setpointKW" }

        locationalPrice:
          type: number
          minimum: 0
          description: Final price including locational adder. Formula: clearingPrice + locationalPriceAdder.currentPrice.
          example: 0.175
          x-jsonld: { "@id": "energyCoordination:locationalPrice" }

        settlement:
          $ref: '#/components/schemas/Settlement'
          description: Settlement information including revenue flows and billing report. Enables unambiguous multi-party billing.

        offsetCommand:
          $ref: '#/components/schemas/OffsetCommand'
          description: Grid operator command to apply offset for flat bid curve plateaus. Used by grid nodes to break ties.

    BidCurvePoint:
      type: object
      description: A single price/power pair in a bid curve.
      additionalProperties: false
      required: [price, powerKW]
      properties:
        price:
          type: number
          minimum: 0
          description: Price per kilowatt-hour at this power level.
          example: 0.06
          x-jsonld: { "@id": "schema:price" }
        powerKW:
          type: number
          description: Power level in kilowatts. Negative values indicate consumption, positive values indicate generation.
          example: 2.0
          x-jsonld: { "@id": "energyCoordination:powerKW" }

    EnergyObjectives:
      type: object
      description: Structured objectives for energy resources expressing goals, constraints, and preferences.
      additionalProperties: false
      properties:
        targetChargeKWh:
          type: number
          minimum: 0
          description: Target energy to charge (for batteries, EVs).
          example: 20
          x-jsonld: { "@id": "energyCoordination:targetChargeKWh" }
        targetGenerationKWh:
          type: number
          minimum: 0
          description: Target energy to generate (for solar, wind).
          example: 30
          x-jsonld: { "@id": "energyCoordination:targetGenerationKWh" }
        targetReductionKW:
          type: number
          maximum: 0
          description: Target demand reduction (for demand flexibility).
          example: -50
          x-jsonld: { "@id": "energyCoordination:targetReductionKW" }
        deadline:
          type: string
          format: date-time
          description: Deadline for achieving the objective (ISO 8601).
          example: "2024-12-15T18:00:00Z"
          x-jsonld: { "@id": "schema:endTime" }
        maxPricePerKWh:
          type: number
          minimum: 0
          description: Maximum acceptable price per kilowatt-hour.
          example: 0.12
          x-jsonld: { "@id": "energyCoordination:maxPricePerKWh" }
        minPricePerKWh:
          type: number
          minimum: 0
          description: Minimum acceptable price per kilowatt-hour (for generators).
          example: 0.05
          x-jsonld: { "@id": "energyCoordination:minPricePerKWh" }
        preferredSource:
          type: string
          enum: [SOLAR, BATTERY, GRID, HYBRID, RENEWABLE]
          description: Preferred energy source type.
          example: "SOLAR"
          x-jsonld: { "@id": "energyCoordination:preferredSource" }
        objectiveConstraints:
          $ref: '#/components/schemas/ObjectiveConstraints'

    ObjectiveConstraints:
      type: object
      description: Constraints for objective fulfillment.
      additionalProperties: false
      properties:
        minChargeKWh:
          type: number
          minimum: 0
          description: Minimum acceptable charge level.
          example: 10
          x-jsonld: { "@id": "energyCoordination:minChargeKWh" }
        maxChargeKWh:
          type: number
          minimum: 0
          description: Maximum acceptable charge level.
          example: 60
          x-jsonld: { "@id": "energyCoordination:maxChargeKWh" }
        minGenerationKWh:
          type: number
          minimum: 0
          description: Minimum acceptable generation level.
          example: 5
          x-jsonld: { "@id": "energyCoordination:minGenerationKWh" }
        maxGenerationKWh:
          type: number
          minimum: 0
          description: Maximum acceptable generation level.
          example: 100
          x-jsonld: { "@id": "energyCoordination:maxGenerationKWh" }

    Settlement:
      type: object
      description: Settlement information including revenue flows and billing report. Enables unambiguous multi-party billing.
      additionalProperties: false
      x-jsonld:
        "@context": ../EnergyCoordination/v1/context.jsonld
        "@type": Settlement
      properties:
        settlementCycles:
          type: array
          description: Array of settlement cycles (reuses existing settlementCycles structure).
          items:
            type: object
            additionalProperties: false
            properties:
              cycleId:
                type: string
                example: "settle-2024-10-04-001"
              status:
                type: string
                enum: [PENDING, SETTLED, FAILED]
                example: "SETTLED"
              amount:
                type: number
                minimum: 0
                example: 100.0
              currency:
                type: string
                example: "INR"
          x-jsonld: { "@id": "energyCoordination:settlementCycles" }
        revenueFlows:
          type: array
          description: Array of revenue flow entries for multi-party settlement.
          items:
            $ref: '#/components/schemas/RevenueFlow'
          x-jsonld: { "@id": "energyCoordination:revenueFlows" }
        settlementReport:
          $ref: '#/components/schemas/SettlementReport'
          description: Structured billing document for settlement.

    RevenueFlow:
      type: object
      description: A single revenue flow entry for a party.
      additionalProperties: false
      properties:
        party:
          $ref: '#/components/schemas/Party'
          description: Party receiving revenue.
        amount:
          type: number
          minimum: 0
          description: Revenue amount for this party.
          example: 60.0
          x-jsonld: { "@id": "schema:amount" }
        currency:
          type: string
          description: Currency code (ISO 4217).
          example: "INR"
          x-jsonld: { "@id": "schema:currency" }
        description:
          type: string
          description: Description of the revenue flow.
          example: "Energy sale (10 kWh × ₹6/kWh)"
          x-jsonld: { "@id": "schema:description" }

    Party:
      type: object
      description: Structure for party identification.
      additionalProperties: false
      properties:
        era:
          type: string
          description: Energy Resource Address of the party.
          example: "prosumer-solar-001"
          x-jsonld: { "@id": "energyCoordination:era" }
        role:
          type: string
          enum: [SELLER, BUYER, GRID_OPERATOR, AGGREGATOR, GOVERNMENT, MARKET_CLEARING_AGENT]
          description: Role of the party in the transaction.
          example: "SELLER"
          x-jsonld: { "@id": "energyCoordination:role" }

    SettlementReport:
      type: object
      description: Structured billing document for settlement.
      additionalProperties: false
      properties:
        reportId:
          type: string
          description: Unique identifier for the settlement report.
          example: "settle-report-2024-10-04-001"
          x-jsonld: { "@id": "energyCoordination:reportId" }
        totalAmount:
          type: number
          minimum: 0
          description: Total settlement amount.
          example: 100.0
          x-jsonld: { "@id": "energyCoordination:totalAmount" }
        currency:
          type: string
          description: Currency code (ISO 4217).
          example: "INR"
          x-jsonld: { "@id": "schema:currency" }
        generatedAt:
          type: string
          format: date-time
          description: Timestamp when the settlement report was generated (ISO 8601).
          example: "2024-10-04T18:30:00Z"
          x-jsonld: { "@id": "schema:dateCreated" }
        breakdown:
          type: object
          description: Breakdown of settlement components (energy cost, wheeling charges, platform fee, tax, etc.).
          additionalProperties: true
          properties:
            energyCost:
              type: number
              minimum: 0
              description: Energy cost component.
              example: 60.0
            wheelingCharges:
              type: number
              minimum: 0
              description: Wheeling charges component.
              example: 20.0
            platformFee:
              type: number
              minimum: 0
              description: Platform fee component.
              example: 10.0
            tax:
              type: number
              minimum: 0
              description: Tax component.
              example: 10.0

    OffsetCommand:
      type: object
      description: Grid operator command to apply offset for flat bid curve plateaus.
      additionalProperties: false
      properties:
        enabled:
          type: boolean
          description: Whether the offset command is enabled.
          example: true
          x-jsonld: { "@id": "schema:enabled" }
        offsetKW:
          type: number
          description: Power offset in kilowatts to apply. Negative values reduce setpoint, positive values increase setpoint.
          example: -2.0
          x-jsonld: { "@id": "energyCoordination:offsetKW" }

