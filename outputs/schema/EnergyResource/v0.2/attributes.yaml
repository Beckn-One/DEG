openapi: 3.1.1
info:
  title: Energy Trade — Energy Resource Attributes (v0.2) with Coordination Extensions
  version: 0.2.0
  x-profile-id: profiles/energy-trade/energy_trade/v0.2/energy-resource
  description: >
    Attribute schemas for energy resources (Item.itemAttributes).
    These attributes are attached to Item.itemAttributes to provide energy-specific 
    characteristics including source type, delivery mode, certification status, 
    meter identifiers, availability details for P2P energy trading, and coordination
    extensions (bid curves, objectives).

components:
  schemas:
    ########################################################################
    # ITEM.ITEMATTRIBUTES — EnergyResource (P2P Energy Trading + Coordination)
    ########################################################################
    EnergyResource:
      type: object
      additionalProperties: false
      x-jsonld:
        "@context": ./context.jsonld
        "@type": EnergyResource
      properties:

        # Core Energy Resource Properties
        sourceType:
          type: string
          enum: [SOLAR, BATTERY, GRID, HYBRID, RENEWABLE]
          description: Type of energy source. Source verification occurs at onboarding but can change post-onboarding (e.g., switching from solar to diesel). Source type influences price but not workflow.
          example: "SOLAR"
          x-jsonld: { "@id": sourceType }

        deliveryMode:
          type: string
          enum: [EV_CHARGING, BATTERY_SWAP, V2G, GRID_INJECTION]
          description: Mode of energy delivery. Used as discovery filter to match consumer requirements.
          example: "GRID_INJECTION"
          x-jsonld: { "@id": deliveryMode }

        certificationStatus:
          type: string
          description: Optional. Carbon offset or green energy certification status (e.g., "Carbon Offset Certified", "Green Energy Certified"). Used for green energy use cases.
          example: "Carbon Offset Certified"
          x-jsonld: { "@id": certificationStatus }

        meterId:
          type: string
          description: Source meter identifier using IEEE 2030.5 mRID (meter Resource ID). Used for discovery and fulfillment tracking.
          example: "100200300"
          x-jsonld: { "@id": "ieee:mRID" }

        inverterId:
          type: string
          description: Optional. Inverter identifier serving as consistent interface between source and grid. Used for P2P trading with inverters. Remains constant even if source changes.
          example: "inv-12345"
          x-jsonld: { "@id": inverterId }

        productionWindow:
          type: object
          description: Time window when energy is produced or available for trading.
          x-jsonld: { "@id": productionWindow }
          additionalProperties: false
          properties:
            start:
              type: string
              format: date-time
              description: Start time of production/availability window (ISO 8601).
              example: "2024-10-04T10:00:00Z"
              x-jsonld: { "@id": "schema:startTime" }
            end:
              type: string
              format: date-time
              description: End time of production/availability window (ISO 8601).
              example: "2024-10-04T18:00:00Z"
              x-jsonld: { "@id": "schema:endTime" }

        # Coordination Extensions
        bidCurve:
          type: array
          description: Array of price/power pairs expressing resource opportunity cost or willingness to transact. Used for market-based coordination and economic disaggregation.
          items:
            $ref: '#/components/schemas/BidCurvePoint'
          x-jsonld: { "@id": "energyCoordination:bidCurve" }
          example:
            - price: 0.05
              powerKW: 0
            - price: 0.06
              powerKW: 2
            - price: 0.07
              powerKW: 5

        constraints:
          $ref: '#/components/schemas/BidCurveConstraints'
          description: Operational constraints for bid curve execution.

        objectives:
          $ref: '#/components/schemas/EnergyObjectives'
          description: Resource objectives expressing goals, constraints, and preferences for energy transactions.

    BidCurvePoint:
      type: object
      description: A single price/power pair in a bid curve.
      additionalProperties: false
      required: [price, powerKW]
      properties:
        price:
          type: number
          minimum: 0
          description: Price per kilowatt-hour at this power level.
          example: 0.06
          x-jsonld: { "@id": "schema:price" }
        powerKW:
          type: number
          description: Power level in kilowatts. Negative values indicate consumption (charging, load), positive values indicate generation (discharge, export), zero indicates no participation.
          example: 2.0
          x-jsonld: { "@id": "energyCoordination:powerKW" }

    BidCurveConstraints:
      type: object
      description: Operational constraints for bid curve execution.
      additionalProperties: false
      properties:
        minPowerKW:
          type: number
          description: Minimum power level in kilowatts.
          example: 0
          x-jsonld: { "@id": "energyCoordination:minPowerKW" }
        maxPowerKW:
          type: number
          description: Maximum power level in kilowatts.
          example: 5
          x-jsonld: { "@id": "energyCoordination:maxPowerKW" }
        rampRateKWPerMin:
          type: number
          minimum: 0
          description: Maximum rate of power change in kilowatts per minute.
          example: 0.5
          x-jsonld: { "@id": "energyCoordination:rampRateKWPerMin" }

    EnergyObjectives:
      type: object
      description: Structured objectives for energy resources expressing goals, constraints, and preferences.
      additionalProperties: false
      properties:
        targetChargeKWh:
          type: number
          minimum: 0
          description: Target energy to charge (for batteries, EVs).
          example: 20
          x-jsonld: { "@id": "energyCoordination:targetChargeKWh" }
        targetGenerationKWh:
          type: number
          minimum: 0
          description: Target energy to generate (for solar, wind).
          example: 30
          x-jsonld: { "@id": "energyCoordination:targetGenerationKWh" }
        targetReductionKW:
          type: number
          maximum: 0
          description: Target demand reduction (for demand flexibility).
          example: -50
          x-jsonld: { "@id": "energyCoordination:targetReductionKW" }
        deadline:
          type: string
          format: date-time
          description: Deadline for achieving the objective (ISO 8601).
          example: "2024-12-15T18:00:00Z"
          x-jsonld: { "@id": "schema:endTime" }
        maxPricePerKWh:
          type: number
          minimum: 0
          description: Maximum acceptable price per kilowatt-hour.
          example: 0.12
          x-jsonld: { "@id": "energyCoordination:maxPricePerKWh" }
        minPricePerKWh:
          type: number
          minimum: 0
          description: Optional. Minimum acceptable price per kilowatt-hour (for generators). Can also be expressed via bidCurve first point.
          example: 0.05
          x-jsonld: { "@id": "energyCoordination:minPricePerKWh" }
        preferredSource:
          type: string
          enum: [SOLAR, BATTERY, GRID, HYBRID, RENEWABLE]
          description: Optional. Preferred energy source type. Can be expressed via discovery filters.
          example: "SOLAR"
          x-jsonld: { "@id": "energyCoordination:preferredSource" }

