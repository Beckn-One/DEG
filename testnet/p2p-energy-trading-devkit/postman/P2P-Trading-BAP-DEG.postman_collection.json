{
    "info": {
        "_postman_id": "bap-deg-p2p-trading-collection",
        "name": "P2P-Trading:BAP-DEG",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
        "description": "Postman collection for BAP (Buyer Application Platform) implementing P2P Energy Trading APIs based on Beckn Protocol v2"
    },
    "item": [
        {
            "name": "discover",
            "item": [
                {
                    "name": "discover-solar-grid-injection",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"context\": {\n    \"version\": \"{{version}}\",\n    \"action\": \"discover\",\n    \"timestamp\": \"{{iso_date}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{transaction_id}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"bpp_id\": \"{{bpp_id}}\",\n    \"bpp_uri\": \"{{bpp_uri}}\",\n    \"ttl\": \"PT30S\",\n    \"domain\": \"{{domain}}\",\n    \"location\": {\n      \"city\": {\n        \"code\": \"BLR\",\n        \"name\": \"Bangalore\"\n      },\n      \"country\": {\n        \"code\": \"IND\",\n        \"name\": \"India\"\n      }\n    }\n  },\n  \"message\": {\n    \"text_search\": \"solar energy grid injection\",\n    \"filters\": {\n      \"type\": \"jsonpath\",\n      \"expression\": \"\" \n //\"$[?(@.itemAttributes.sourceType == 'SOLAR' && @.itemAttributes.deliveryMode == 'GRID_INJECTION' && @.itemAttributes.availableQuantity >= 10.0 && @.itemAttributes.productionWindow.start <= '2024-10-04T10:00:00Z' && @.itemAttributes.productionWindow.end >= '2024-10-04T18:00:00Z')]\"\n    }\n  }\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{bap_adapter_url}}/discover",
                            "host": [
                                "{{bap_adapter_url}}"
                            ],
                            "path": [
                                "discover"
                            ]
                        },
                        "description": "Discover available solar energy resources with grid injection delivery mode. Uses JSONPath filters to find resources matching specific criteria."
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "select",
            "item": [
                {
                    "name": "select-energy-offer",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"context\": {\n    \"version\": \"{{version}}\",\n    \"action\": \"select\",\n    \"timestamp\": \"{{iso_date}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{transaction_id}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"bpp_id\": \"{{bpp_id}}\",\n    \"bpp_uri\": \"{{bpp_uri}}\",\n    \"ttl\": \"PT30S\",\n    \"domain\": \"{{domain}}\"\n  },\n  \"message\": {\n    \"order\": {\n      \"@context\": \"https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld\",\n      \"@type\": \"beckn:Order\",\n      \"beckn:id\": \"order-energy-001\",\n      \"beckn:items\": [\n        {\n          \"beckn:id\": \"energy-resource-solar-001\",\n          \"quantity\": {\n            \"count\": 10.0,\n            \"unit\": \"kWh\"\n          }\n        }\n      ],\n      \"beckn:offers\": [\n        {\n          \"beckn:id\": \"offer-energy-001\"\n        }\n      ],\n      \"beckn:provider\": {\n        \"beckn:id\": \"provider-solar-farm-001\"\n      }\n    }\n  }\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{bap_adapter_url}}/select",
                            "host": [
                                "{{bap_adapter_url}}"
                            ],
                            "path": [
                                "select"
                            ]
                        },
                        "description": "Select energy resource and offer to receive a priced orderValue with breakdown in components array."
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "init",
            "item": [
                {
                    "name": "init-energy-order",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"context\": {\n    \"version\": \"{{version}}\",\n    \"action\": \"init\",\n    \"timestamp\": \"{{iso_date}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{transaction_id}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"bpp_id\": \"{{bpp_id}}\",\n    \"bpp_uri\": \"{{bpp_uri}}\",\n    \"ttl\": \"PT30S\",\n    \"domain\": \"{{domain}}\"\n  },\n  \"message\": {\n    \"order\": {\n      \"@context\": \"https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld\",\n      \"@type\": \"beckn:Order\",\n      \"beckn:id\": \"order-energy-001\",\n      \"beckn:items\": [\n        {\n          \"beckn:id\": \"energy-resource-solar-001\",\n          \"quantity\": {\n            \"count\": 10.0,\n            \"unit\": \"kWh\"\n          }\n        }\n      ],\n      \"beckn:offers\": [\n        {\n          \"beckn:id\": \"offer-energy-001\"\n        }\n      ],\n      \"beckn:provider\": {\n        \"beckn:id\": \"provider-solar-farm-001\"\n      },\n      \"beckn:fulfillments\": [\n        {\n          \"@type\": \"beckn:Fulfillment\",\n          \"beckn:id\": \"fulfillment-energy-001\",\n          \"beckn:type\": \"ENERGY_DELIVERY\",\n          \"beckn:stops\": [\n            {\n              \"@type\": \"beckn:Stop\",\n              \"beckn:id\": \"stop-start-001\",\n              \"beckn:type\": \"START\",\n              \"beckn:location\": {\n                \"@type\": \"beckn:Location\",\n                \"beckn:address\": \"100200300\"\n              },\n              \"beckn:time\": {\n                \"@type\": \"beckn:Time\",\n                \"beckn:range\": {\n                  \"start\": \"2024-10-04T10:00:00Z\",\n                  \"end\": \"2024-10-04T18:00:00Z\"\n                }\n              }\n            },\n            {\n              \"@type\": \"beckn:Stop\",\n              \"beckn:id\": \"stop-end-001\",\n              \"beckn:type\": \"END\",\n              \"beckn:location\": {\n                \"@type\": \"beckn:Location\",\n                \"beckn:address\": \"98765456\"\n              },\n              \"beckn:time\": {\n                \"@type\": \"beckn:Time\",\n                \"beckn:range\": {\n                  \"start\": \"2024-10-04T10:00:00Z\",\n                  \"end\": \"2024-10-04T18:00:00Z\"\n                }\n              }\n            }\n          ]\n        }\n      ],\n      \"beckn:payments\": [\n        {\n          \"@type\": \"beckn:Payment\",\n          \"beckn:id\": \"payment-energy-001\",\n          \"beckn:type\": \"ON-FULFILLMENT\",\n          \"beckn:status\": \"NOT-PAID\",\n          \"beckn:collected_by\": \"BPP\"\n        }\n      ],\n      \"beckn:billing\": {\n        \"@type\": \"beckn:Billing\",\n        \"beckn:name\": \"Energy Consumer\",\n        \"beckn:email\": \"consumer@example.com\",\n        \"beckn:phone\": \"+1-555-0100\"\n      }\n    }\n  }\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{bap_adapter_url}}/init",
                            "host": [
                                "{{bap_adapter_url}}"
                            ],
                            "path": [
                                "init"
                            ]
                        },
                        "description": "Initialize order with fulfillment details (meter IDs, time window) and payment information."
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "confirm",
            "item": [
                {
                    "name": "confirm-energy-order",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"context\": {\n    \"version\": \"{{version}}\",\n    \"action\": \"confirm\",\n    \"timestamp\": \"{{iso_date}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{transaction_id}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"bpp_id\": \"{{bpp_id}}\",\n    \"bpp_uri\": \"{{bpp_uri}}\",\n    \"ttl\": \"PT30S\",\n    \"domain\": \"{{domain}}\"\n  },\n  \"message\": {\n    \"order\": {\n      \"@context\": \"https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld\",\n      \"@type\": \"beckn:Order\",\n      \"beckn:id\": \"order-energy-001\",\n      \"beckn:items\": [\n        {\n          \"beckn:id\": \"energy-resource-solar-001\",\n          \"quantity\": {\n            \"count\": 10.0,\n            \"unit\": \"kWh\"\n          }\n        }\n      ],\n      \"beckn:offers\": [\n        {\n          \"beckn:id\": \"offer-energy-001\"\n        }\n      ],\n      \"beckn:provider\": {\n        \"beckn:id\": \"provider-solar-farm-001\"\n      },\n      \"beckn:fulfillments\": [\n        {\n          \"@type\": \"beckn:Fulfillment\",\n          \"beckn:id\": \"fulfillment-energy-001\",\n          \"beckn:type\": \"ENERGY_DELIVERY\"\n        }\n      ],\n      \"beckn:payments\": [\n        {\n          \"@type\": \"beckn:Payment\",\n          \"beckn:id\": \"payment-energy-001\",\n          \"beckn:type\": \"ON-FULFILLMENT\",\n          \"beckn:status\": \"NOT-PAID\",\n          \"beckn:collected_by\": \"BPP\"\n        }\n      ]\n    }\n  }\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{bap_adapter_url}}/confirm",
                            "host": [
                                "{{bap_adapter_url}}"
                            ],
                            "path": [
                                "confirm"
                            ]
                        },
                        "description": "Confirm order to activate the energy trade contract."
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "status",
            "item": [
                {
                    "name": "status-energy-order",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"context\": {\n    \"version\": \"{{version}}\",\n    \"action\": \"status\",\n    \"timestamp\": \"{{iso_date}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{transaction_id}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"bpp_id\": \"{{bpp_id}}\",\n    \"bpp_uri\": \"{{bpp_uri}}\",\n    \"ttl\": \"PT30S\",\n    \"domain\": \"{{domain}}\"\n  },\n  \"message\": {\n    \"order\": {\n      \"@context\": \"https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld\",\n      \"@type\": \"beckn:Order\",\n      \"beckn:id\": \"order-energy-001\"\n    }\n  }\n}",
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        },
                        "url": {
                            "raw": "{{bap_adapter_url}}/status",
                            "host": [
                                "{{bap_adapter_url}}"
                            ],
                            "path": [
                                "status"
                            ]
                        },
                        "description": "Query order and delivery status. Can be called multiple times during delivery to monitor progress."
                    },
                    "response": []
                }
            ]
        }
    ],
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Pure JS pre-request script to replace moment()",
                    "",
                    "// 1) ISO 8601 timestamp without needing moment",
                    "const isoTimestamp = new Date().toISOString();",
                    "pm.collectionVariables.set('iso_date', isoTimestamp);"
                ]
            }
        }
    ],
    "variable": [
        {
            "key": "domain",
            "value": "beckn.one:deg:p2p-trading:2.0.0"
        },
        {
            "key": "version",
            "value": "2.0.0"
        },
        {
            "key": "bap_id",
            "value": "p2p-trading-sandbox1.com"
        },
        {
            "key": "bap_uri",
            "value": "http://onix-bap:8081/bap/receiver"
        },
        {
            "key": "bpp_id",
            "value": "p2p-trading-sandbox2.com"
        },
        {
            "key": "bpp_uri",
            "value": "http://onix-bpp:8082/bpp/receiver"
        },
        {
            "key": "bap_adapter_url",
            "value": "http://localhost:8081/bap/caller"
        },
        {
            "key": "transaction_id",
            "value": "3769776b-88b4-469d-9ee2-95044fe5dafc"
        },
        {
            "key": "iso_date",
            "value": ""
        }
    ]
}